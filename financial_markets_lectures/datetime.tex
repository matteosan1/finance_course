\chapter{Date and Time}
\label{sec:datetime}

In this Chapter we take a little break and concentrate on a topic that it is not usually covered in a \texttt{python} review for beginners. However given its importance for financial computation the next paragraphs will be devoted to a close look up on the \texttt{datetime} module~\cite{bib:datetime}, whose usage will help in manipulating dates.

\section{Dates}\label{dates}

As said dates are not usually included in a standard \texttt{python} tutorial, however since they 
are pretty essential for finance we are going to cover this topic in some detail. 
In \texttt{python} the date utilities mainly lives in the \texttt{datetime} module. Briefly we are 
also going to show \texttt{relativedelta} from the \texttt{dateutil} module, which allows to 
add/subtract days/months/years to dates, in other words to make operations on them.

In this first example today's date is defined and with \texttt{relativedelta} two more dates are created 
adding two months and subtracting three days to the first one.

\begin{ipythonnon}
from datetime import date, datetime
from dateutil.relativedelta import relativedelta

date1 = date.today()
print(date1)

date2 = date.today() + relativedelta(months=2)
print(date2)

date3 = date.today() - relativedelta(days=3)
print(date3)
\end{ipythonnon}
\begin{ioutput}
2020-08-03
2020-10-03
2020-07-31
\end{ioutput}

There is another way of computing a new date: a one day delta is stored in a variable 
and today's date is moved by three days multiplying the defined delta by three.

\begin{ipythonnon}
one_day = relativedelta(days=1)
date.today() - 3 * one_day
\end{ipythonnon}
\begin{ioutput}
datetime.date(2020, 7, 31)
\end{ioutput}

Next, given two dates their difference is computed and expressed in number of days.

\begin{ipythonnon}
date1 = date(2019, 7, 2)
date2 = date(2019, 8, 16)
(date2 - date1).days
\end{ipythonnon}
\begin{ioutput}
45
\end{ioutput}

Dates can be converted to and from strings and a large variety of formats can be specified in this conversions. 
The format is determined by a string in which each character starting with \% represent an element 
of the date, e.g. \%Y year, \%d day, \%s seconds\ldots

Below dates to string conversion:

\begin{ipythonnon}
date1 = date(2019, 7, 2)
date1.strftime("%Y-%b-%d (%a)") # dates can formatted in many ways
                                # check the docs for more details
\end{ipythonnon}
\begin{ioutput}
'2019-Jul-02 (Tue)'
\end{ioutput}

And here, a string is converted to \texttt{datetime} object:

\begin{ipythonnon}
# a string can be converted to dates too
datetime.strptime('25 Aug 2019', "%d %b %Y").date()
\end{ipythonnon}
\begin{ioutput}
datetime.date(2019, 8, 25)
\end{ioutput}

Finally a last example showing how to get the week-day from a date:

\begin{ipythonnon}
date1.weekday() # 0 = Monday, ..., 6 = Sunday
\end{ipythonnon}
\begin{ioutput}
1
\end{ioutput}

\section{Date Utilities}

\subsection{TimeInterval}

\begin{finmarkets}
As said date management is very important in financial application, so the \texttt{finmarkets} module implements a couple of utilities to ease the work. 
This simple function take in input a string representing a time interval (e.g. \texttt{"1y"} or \texttt{"5d"}) and convert it into a \texttt{relativedelta} object to be directly used with a \texttt{datetime.date}.
\end{finmarkets}

\pythoncodenon{code/datetime_timeinterval.py}
An example of usage is
\begin{ipythonnon}
from datetime import date
from finmarkets import TimeInterval

date = date(2024, 9, 6)
print (date)
print (date + TimeInterval("1y"))
print (date + TimeInterval("2m"))
\end{ipythonnon}
\begin{ioutput}
2024-09-06
2025-09-06
2024-11-06
\end{ioutput}

\subsection{Payment Dates Generator}

\begin{finmarkets}
Another very useful tool available in \texttt{finmarkets} is the function \texttt{generate\_dates}. Its main purpose is to generate list of dates (e.g. payment dates), a task that we need to do often from now on. 
time
It takes in input: a starting date (the first date of the list), an end date which represents the "length" of the list (it can be an actual date or a \texttt{TimeInterval}) and frequency (12 months by default). Note that if the maturity is not a multiple of 12 months the last period will be truncated to the last date. It returns the list of dates.
\end{finmarkets}

\pythoncodenon{code/datetime_generate_dates.py}

\begin{ioutput}
[datetime.date(2020, 10, 20), datetime.date(2021, 10, 20), 
datetime.date(2022, 10, 20), datetime.date(2022, 11, 20)]
\end{ioutput}

\section*{Exercises}
\input{datetime_ex_text}
