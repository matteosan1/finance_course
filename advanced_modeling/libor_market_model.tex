\documentclass{beamer}
\usetheme{afm}

\title{Libor Market Models}
\course{Advanced Financial Modeling}
\author{\href{mailto:matteo.sani@unisi.it}{Matteo Sani}}

\begin{document}
\begin{frame}[plain]
  \maketitle
\end{frame}

\section{Libor Market Model}
\begin{frame}{Before Market Models}
  \begin{itemize}
  \item<1-> For a very long time, the market practice has been to value caps, floors and swaptions (which represent the vast majority of interest rate market) by using a formal extension of the Black (1976) model. 
  \item<2-> However, this formula was applied in a completely heuristic way, under some simplifying and inexact assumptions.
    \begin{enumerate}
    \item<3-> despite the use of \emph{short rate models}; $r$ was assumed to be deterministic, so that the discounting could be factorized out of the expectation in the risk-neutral pricing formula; 
    \item<4-> then, inconsistently, the forward LIBOR rates were modeled as drift-less geometric Brownian motions (hence stochastic);
    \item<5-> finally the expectation could be viewed as the price of a call option in a market with zero risk-free rate, therefore obtained through the Black’s formula.
    \end{enumerate} 
  \item<6-> \textcolor{red}{Unfortunately this is logically inconsistent.}
  \end{itemize}
\end{frame}

\begin{frame}{Market Models}
  \begin{itemize}
  %\item The principal idea of these approaches is to choose a different numeraire than the risk-free bank account.
    %The interest rate market is radically different from the others, e.g. commodities or equities, thus needs a own kind of modeling. 
  \item<1-> There are three possible choices in interest rate modeling: \textcolor{red}{short rate models} (that model one single variable), \textcolor{red}{instantaneous forward rate models} (that model all infinite points of the term structure at once) and \textcolor{red}{Market Models}.
  \item<2-> The latter family of (arbitrage-free) models, introduced at the end of the '90, has the following nice characteristics:
    \begin{itemize}
    \item<3-> models a selection of discrete real world rates (quoted in the market) spanning the term structure;
    \item<4-> chooses a different numeraire than the risk-free bank account such that these rates can be modeled log-normally;
    \item<5-> produces pricing formulas of the Black-76 type for caps/floors and swaptions;
    \item<6-> is relatively easy to calibrate to market data and can be used to price more exotic products.
    \end{itemize}
  \end{itemize}
\end{frame}
%The model we are introducing is best known generally as ”LIBOR Market Model” (LMM), or else ”Log-normal Forward LIBOR Model” or ”BraceGatarek-Musiela 1997 Model” (BGM model), 

\begin{frame}{Setting the Model}
  \begin{itemize}
  \item<1-> $t = 0$ is the current time and the set $\{T_0, T_1, \dots, T_n\}$ of expiry-maturity dates is the tenor structure. %with the corresponding year fractions $\tau_i$ associated with the expiry-maturity pair $(T_{i−1}, T_i)$, for all $i > 0$;
  \item<2-> The simply-compounded forward interest rate resetting at its expiry date $T_{i-1}$ and with maturity $T_i$ is denoted by $F_i(t) = F(t; T_{i-1}, T_i)$;
  \item<3-> $\mathcal{Q}^i$ is the equivalent martingale measure (EMM) associated with the numeraire $P(\cdot, T_i)$, i.e. the $T_i$-forward measure;
  \item<4-> $Z^i$ is a $n$-dimensional \textcolor{red}{correlated} Brownian motion under $\mathcal{Q}^i$, with \emph{instantaneous} correlation matrix $\rho$, i.e. $dZ^i(t) dZ^i(t) = \rho dt$.
  \end{itemize}
\uncover<5->{
  We have already seen that $F_i$ is a martingale under the corresponding $T_i$-forward measure, on the interval $[0, T_{i-1}]$, \textcolor{red}{hence each $F_i$ has a drift-less dynamics under $\mathcal{Q}^i$.}}
\end{frame}

\begin{frame}{Forward Rate Dynamics}
  \begin{block}{Proposition}
    A discrete tenor Libor Market Model assumes that the forward rates have the following dynamics under their associated forward measures:
    \begin{equation}
      dF_i(t) = \sigma_i(t)F_i(t)dZ_i(t), t \le T_{i-1},\quad\text{ for } i = 1,\ldots, n
      \label{eq:forward_process_lmm}
    \end{equation}
    where $\sigma_i$ is assumed to be deterministic and scalar, whereas $dZ_i$ is the $i$-th component of the Brownian motion.
  \end{block}
\pause
  We know that, if $\sigma_i$ is bounded, the solution for $F_i$ is 
  \begin{equation*}
    F_i(T) = F_i(t) \exp\left(\int_t^T\sigma_i(s)dZ_i(s)ds - \frac{1}{2}\int_t^T 
    \sigma_i^2(s)ds\right),\quad 0\le t \le T \le T_{i-1} 
  \end{equation*}
  (for a non-rigorous proof see next slide.)
\end{frame}

\begin{frame}{Exponential Martingale}
  \begin{itemize}
	  \item<1-> We have already seen that the solution of the SDE $dF_t=\mu_t F_t dt + \sigma_t F_t dW_t$ is
	    \begin{equation*}
		      \frac{F_T}{F_t} = e^{\int_t^T(\mu_s -\frac{1}{2}\sigma_s^2)ds+\int_t^T\sigma_s dW}
		    \end{equation*}
	  \item<2-> If we now assume the drift coefficient $\mu_t=0$ 
	    \begin{equation*}
		    \frac{F_T}{F_t} = e^{\int_t^T-\frac{1}{2}\sigma_s^2 ds+\int_t^T\sigma_s dW}
	    \end{equation*}
	  is a solution for $dF_t=\sigma_t F_tdW_t$
	  \item<3-> \textcolor{red}{This is a pretty straightforward result, but what is the $F_i$ dynamics under the $T^j$-measure ($i\neq j$) ?}
	  \end{itemize}
\end{frame}


\begin{frame}{Forward Rate Dynamics in LMM}
  \begin{block}{Proposition}
    Under the assumptions of the Libor Market Model, the dynamics of each $F_k$, for $k = 1,\ldots, n$, under the forward measure $\mathcal{Q}^i$ with $i \in \{1,\ldots, n\}$, is:
    \begin{equation}
      \begin{cases}
	k < i: dF_k(t) = -\sigma_k(t)F_k(t)\sum_{j=k+1}^i\cfrac{\rho_{k,j}\tau_j\sigma_j(t)F_j(t)}{1+\tau_jF_j(t)}dt + \sigma_k(t)F_k(t)dZ^i_k(t) \\ \vspace{0.1cm}
	k = i : dF_k(t) = \sigma_k(t)F_k(t)dZ_k^i(t) \\
	\vspace{0.1cm}
	k > i : dF_k(t) = \sigma_k(t)F_k(t)\sum_{j=k+1}^i\cfrac{\rho_{k,j}\tau_j\sigma_j(t)F_j(t)}{1+\tau_jF_j(t)}dt + \sigma_k(t)F_k(t)dZ^i_k(t)		
      \end{cases}
  	\label{eq:forward_rat_dynamics_lfm}
    \end{equation}
    for $t \le \min\{T_{k-1}, T_i\}$.
  \end{block}
\end{frame}

\begin{frame}{Forward Rate Dynamics in LMM (Proof)}
  \begin{itemize}
  \item<1-> By assumption, there exist a Libor Market Model satisfying \cref{eq:forward_process_lmm}.
  \item<2-> We would like to determine the deterministic functions $\mu_k^i(t, \bar{F}(t))$, with ($\bar{F}(t)$ is the vector $(F_1(t),\ldots, F_n(t))$), that satisfies
    \begin{equation}
      dF_k(t) = \mu_k^i(t, \bar{F}(t))F_k(t)dt + \sigma_k(t)F_k(t)dZ^i_k(t),\quad k\neq i
      \label{eq:forward_dynamics_in_lfm}
    \end{equation}
  \item<3-> Let's apply the change of measure from $\mathcal{Q}^i$ to $\mathcal{Q}^k$, then impose that the $\mathcal{Q}^k$ resulting drift is null. 
  \item<4-> The Radon-Nikodym derivative of $\mathcal{Q}^{i-1}$ w.r.t. $\mathcal{Q}^i$ at time $t$ is
    \begin{equation*}
      \frac{dQ^{i-1}}{dQ^i}\bigg|\mathcal{F}_t = \frac{P(t, T_{i-1})P(0, T_i)}{P(0, T_{i-1})P(t, T_i)} = \zeta^i_t
    \end{equation*}
  \end{itemize}
\end{frame}

\begin{frame}{Forward Rate Dynamics in LMM (Proof)}
  \begin{itemize}
  \item<1-> From the forward rate definition $\cfrac{P(t,T_{i-1})}{P(t,T_i)} = 1 + \tau_i F_i$ so
    \begin{equation*}
      \zeta^i_t = \frac{P(0, T_i)}{P(0, T_{i-1})}(1+F_i(t)\tau_i)
    \end{equation*}
    therefore, assuming \cref{eq:forward_process_lmm}, the dynamics of $\zeta^i_t$ under $\mathcal{Q}^i$ is
    \begin{equation*}
      \begin{aligned}
	d\zeta^i_t &= \frac{P(0, T_i)}{P(0, T_{i-1})}dF_i(t)\tau_i = \frac{P(0, T_i)}{P(0, T_{i-1})}\tau_i\sigma_i(t)F_i(t)dZ^i_i(t) = \\ &= \frac{\tau_i\sigma_i(t)F_i(t)}{1+F_i(t)\tau_i}\zeta_t^idZ^i_i(t)=\lambda \zeta_t^idZ^i_i(t)
      \end{aligned}
    \end{equation*}
  \item<2-> Thus, the Radon-Nikodym derivative $\zeta^i$ is an exponential martingale with associated process $\lambda$ that is the $n$-dimensional vector $\lambda = \left(0,\ldots,\frac{\tau_i\sigma_iF_i}{1+F_i\tau_i},\ldots, 0\right)$
  \end{itemize}
\end{frame}

\begin{frame}{Forward Rate Dynamics in LMM (Proof)}
  \begin{itemize}
  \item<1-> So from the Girsanov theorem:
    \begin{equation*}
      dZ^i(t) = dZ^{i-1}(t)+\rho\lambda dt = dZ^{i-1}(t)+\rho^{ji}\frac{\tau_i\sigma_i(t)F_i(t)}{1+F_i(t)\tau_i} dt
    \end{equation*}
  \item<2-> Applying this inductively we obtain
    \begin{equation*}
  	\begin{cases}
	k < i : dZ^i_j = dZ^k_j + \sum_{h=k+1}^i \rho^{jh}\cfrac{\tau_h\sigma_h(t)F_h(t)}{1+F_h(t)\tau_h} dt;\\
	k > i : dZ^i_j = dZ^k_j - \sum_{h=k+1}^i \rho^{jh}\cfrac{\tau_h\sigma_h(t)F_h(t)}{1+F_h(t)\tau_h} dt;\\
  	\end{cases}
    \end{equation*}
  \end{itemize}
\end{frame}

\begin{frame}{Forward Rate Dynamics in LMM (Proof)}
	\begin{itemize}
	\item<1-> Then, inserting these into \cref{eq:forward_dynamics_in_lfm} and requiring the drift to be zero, we have:
		\begin{equation*}
			\begin{gathered}
				k < i : F_k(t)\left( \mu_k^i(t, F(t)) + \sigma_i(t)\sum_{h=k+1}^i \rho^{jh} \frac{\tau_h\sigma_h(t)F_h(t)}{1+F_h(t)\tau_h}\right) dt = 0 \\
				\implies \mu_k^i(t, F(t)) = - \sigma_i(t)\sum_{h=k+1}^i \rho^{jh} \frac{\tau_h\sigma_h(t)F_h(t)}{1+F_h(t)\tau_h}
			\end{gathered}
		\end{equation*}
		and similarly for $k > i$.
	\item<2-> At this point, we can turn around the argument to have the following existence result.
	\end{itemize}
\end{frame}

\subsection{Log-normal Forward Model}
\begin{frame}{Log-normal Forward Libor Model}
  \begin{block}{Proposition}
    Consider a given volatility structure $\sigma_1,\ldots, \sigma_n$, where each $\sigma_i$ is bounded, and the terminal measure $\mathcal{Q}^n$ with associated $n$-dimensional correlated Brownian motions $Z^n$. If we define the processes $F_1,\ldots, F_n$ by
    \begin{equation}
      dF_i(t) = -\sigma_i(t)F_i(t)\sum_{j=i+1}^n \rho^{ij} \frac{\tau_j\sigma_j(t)F_j(t)}{1+F_j(t)\tau_j} dt + \sigma_i(t)F_i(t)dZ^n_i(t)
    \end{equation}
    for $i = 1,\ldots, n$, then the $\mathcal{Q}^i$-dynamics of $F_i$ is given by \cref{eq:forward_process_lmm}, i.e. there exists a Libor Model with the given volatility structure.
  This model is often called \textcolor{red}{log-normal forward Libor model} from the log-normal distribution of each forward rate under the related forward measure.
  \end{block}
\end{frame}

%Proof. First, we have to prove the existence of a solution of (2.5). For i = M
%we simply have
%dFM = σM (t)FM(t)dZM
%M (t),
%which is just an exponential martingale, where σM is bounded, thus a solution
%does exist. Now we proceed by induction: assume that (2.5) admits a solution
%for i + 1, . . . , M, then we write the i-th dynamics as
%dFi(t) = µi(t, Fi+1(t), . . . , FM(t))Fidt + σi(t)Fi(t)dZM
%i
%(t),
%where the crucial fact is that µi depends only on FK for k = i + 1, . . . , M.
%Thus, denoting F
%M
%i+1 := (Fi+1, . . . , FM)
%′
%, we can solve explicitly the above
%SDE by applying the Itˆo formula:
%d ln Fi(t) = dFi(t)
%Fi(t)
%−
%1
%2Fi(t)
%2
%σi(t)
%2Fi(t)
%2
%dt
%= µi(t, F M
%i+1(t))dt + σi(t)dZM
%i
%(t) −
%1
%2
%σi(t)
%2
%dt
%⇒ ln Fi(t) = ln Fi(0) + R t
%0
%
%µi(s, F M
%i+1(s)) −
%σi(s)
%2
%2
%
%ds +
%R t
%0
%σi(s)dZi
%i
%(s)
%⇒ Fi(t) = Fi(t) exp hR t
%0
%
%µi(s, F M
%i+1(s)) −
%σi(s)
%2
%2
%
%dsi
%exp hR t
%0
%σi(s)dZi
%i
%(s)
%i
%,
%for 0 ≤ t ≤ Ti−1 . This proves existence.
%Then, we have to prove that the process λ defined in (2.4) satisfies the
%2.1 Pricing Caps in the LMM 31
%Novikov condition (B.1), in which case the density process γ
%i
%is a Qi-martingale
%and consequently we can apply the Girsanov Theorem, retracing the same
%steps as in the proof of Proposition 2.0.2. In this regard, given an initial
%positive LIBOR term structure, as it is F(0) = (F1(0), . . . , FM(0))′
%, notice
%that all LIBOR rate processes will be always positive, thus the process λ
%in (2.4) is bounded and consequently satisfies the Novikov condition.

\begin{frame}{LFM and Black Price Equivalence}
	\begin{block}{Proposition}
		The price of the $i$-th caplet implied by the Libor market model coincides with that given by the corresponding Black caplet formula:
		\begin{equation}
			\textbf{Caplet}^{LFM}(0, T_{i-1}, T_i, K, v_i)= \tau_i P(0, T_i) Bl(K, F(0; T_{i-1}, T_i), v_i\sqrt{T_{i-1}})
		\end{equation}
		where
		\begin{equation}
			v_i^2 = \frac{1}{T_{i-1}}\int_0^{T_{i-1}}\sigma_i^2(t)dt
			\label{eq:caplet_black_vol}
		\end{equation}
	\end{block}
\end{frame}

\begin{frame}{LFM and Black Price Equivalence (Proof)}
	\begin{itemize}
	%\item<1-> The discounted payoff of a cap (with unit nominal) is 
	%\begin{equation*}
	%	\textbf{Cap}_{payoff} = \sum_{i=\alpha+1}^\beta \tau_iD(0, 	T_i)(F(T_{i-1}; T_{i-1}, T_i) - K)^+
	%\end{equation*}
	\item<1-> According to the risk-neutral pricing formula the price of a cap is 
	\begin{equation*}
		\textbf{Cap}=\mathbb{E}^B\left[\sum_{i=\alpha+1}^\beta 	\tau_iD(0, T_i)(F(T_{i-1}; T_{i-1}, T_i) - K)^+\right]
	\end{equation*}
	\item<2-> Given the linearity of the expectation operator, we can apply the change of measure technique to move to $\mathcal{Q}^i$, i.e. the $T$-forward measure associated to bond price $P(\cdot,T_i)$
	\begin{equation*}
		\textbf{Cap}= \sum_{i=\alpha+1}^\beta \tau_i P(0, T_i)\mathbb{E}^i[(F(T_{i-1}; T_{i-1}, T_i) - K)^+] = \sum_{i=\alpha+1}^\beta P(0, T_i)\textbf{Caplet}
	\end{equation*}
	\end{itemize}
\end{frame}

\begin{frame}{LFM and Black Price Equivalence (Proof)}
	\begin{itemize}
	\item In order to compute 
	\begin{equation*}
		\textbf{Caplet} = \mathbb{E}^i[(F_i(T_{i-1}) - K)^+]
	\end{equation*}
	just remember that under $\mathcal{Q}^i$ the process $F_i$ is a martingale.
	\item Given its lognormal distribution, the above expectation is computed as \textcolor{red}{a Black and Scholes price for a stock call option whose underlying “stock” is $F_i$, struck at $K$, with maturity $T_{i-1}$, with zero constant “risk-free rate” and instantaneous percentage volatility $\sigma_i(t)$.}
\end{itemize}
\end{frame}

\begin{frame}{Flat and Spot Volatilities}
	\begin{itemize}
		\item<1-> In the market, cap prices are not quoted in monetary terms, but rather in terms of the so-called implied Black volatilities. 
		\item<2-> The implied \textcolor{red}{flat volatilities} are the solutions $v_{T_1-cap},\ldots, v_{T_n-cap}$ of the equations
		\begin{equation*}
			\textbf{Cap}(t, \mathcal{T}_j, K) = \sum_{i=1}^j \textbf{Caplet}^{Black}(t, T_{i-1}, T_i,K,v_{T_j-cap}),\quad j=1, \ldots,n
		\end{equation*}
		\item<3-> While the implied \textcolor{red}{spot volatilities} are the solutions $v_{T_1-caplet},\ldots, v_{T_n-caplet}$ of
		\begin{equation*}
			\textbf{Caplet}(t, T_{i-1},T_i,K) = \textbf{Caplet}^{Black}(t, T_{i-1}, T_i,K,v_{T_i-caplet}),\quad i=1, \ldots,n
		\end{equation*} 
		where $\textbf{Caplet}(t, T_{i-1}, T_i, K) = \textbf{Cap}(t, \mathcal{T}_i,K)-\textbf{Cap}(t, \mathcal{T}_{i-1},K)$
	\end{itemize}
\end{frame}

\begin{frame}{Flat and Spot Volatilities}
	\begin{itemize}
		\item<1-> Notice that flat volatility $v_{T_1-cap}$ is that implied by the Black formula by putting the same average volatility in all caplets up to $T_j$, whereas the spot volatility $v_{T_i-caplet}$ is just the implied average volatility from caplet over $[T_{i-1}, T_i]$.
		\item<2-> To recover correctly cap prices according to the LFM dynamics, we need to have
		\begin{equation*}
			\begin{aligned}
				\textbf{Cap} = \sum_{i=1}^j&\tau_iP(t,T_i)\textbf{Caplet}^{Black}(K,F(t;T_{i-1},T_i),\sqrt{T_{i-1}v_{T_j-cap}}) = \\ &\sum_{i=1}^j\tau_iP(t,T_i)\textbf{Caplet}^{Black}(K,F(t;T_{i-1},T_i),\sqrt{T_{i-1}v_{T_i-caplet}}),\\
				&\hspace{75mm}\forall j = 1,\dots, n
			\end{aligned}
		\end{equation*}
	\end{itemize}
\end{frame}	

%\begin{frame}{Cap Price}
%	\begin{itemize}
%		\item From the risk-neutral valuation formula we get that the price of a cap with tenor $\mathcal{T} = \{T_\alpha,\ldots, T_\beta\}$, year fractions $\tau$, rate $K$ and unit notional amount is
%		\begin{equation*}
%			\begin{aligned}
%				\textbf{Cap} = &\mathbb{E}^\mathcal{Q}\left[\sum_{i=\alpha+1}^{\beta}D(t,T_i)\tau_i(L(T_{i-1},T_i)-K)^+|\mathcal{F}_t\right]= \\
%				&\sum_{i=\alpha+1}^{\beta}\tau_i\mathbb{E}^\mathcal{Q}[D(t,T_i)(L(T_{i-1},T_i)-K)^+|\mathcal{F}_t]
%			\end{aligned}
%		\end{equation*}
%		\item As we have already seen, moving from the probability measure $\mathcal{Q}^B$ to the $T_i$-forward measure in each $i$-th term, we can decouple the discounting from the expectation
%		\begin{equation*}
%			\textbf{Cap} = \sum_{i=\alpha+1}^{\beta}\tau_iP(t,T_i)\mathbb{E}^i[(L(T_{i-1},T_i)-K)^+|\mathcal{F}_t]
%		\end{equation*}
%	\end{itemize}
%\end{frame}

\begin{frame}{Remarks on LFM and Cap Pricing}
\begin{itemize}
	\item<1-> The \textcolor{red}{joint dynamics of forward rates is not involved in the pricing of a cap}, its payoff is just a sum of caplet payoffs, i.e. marginal distributions of forward rates are enough to compute the expectation, correlation does not matter. 
	\item <2-> Indeed, there are no expectations involving two or more forward rates at the same time, so that correlations are not relevant.
	\item<3-> From \cref{eq:caplet_black_vol} it is clear how it is impossible to uniquely determine the instantaneous volatility $\sigma_i(t)$ as there exist plenty of functions that would integrate to $v_i$.
	\item<4-> Since usually one looks at particular interest rate fixings at a finite amount of times, it is customary to specify $\sigma_i(t)$ as a piecewise-constant function.
	\end{itemize}
\end{frame}

\begin{frame}{Remarks on LFM and Cap Pricing}
	\begin{itemize}
	\item In general, term structures of forward rate volatilities shape does not change significantly over time. 
	\item Further, forward rate volatilites are low close to expiry, peak around 1-2 years and then fall off again (hump-shaped).
	\end{itemize}
	\begin{center}
		\includegraphics[width=0.5\linewidth]{cap_vola}
	\end{center}
\end{frame}

\begin{frame}{Remarks on LFM and Cap Pricing}
	\begin{itemize}
	\item<1-> A possible explanation of the humped shape is obtained by segmenting the caplet market across three maturities, (see Rebonato, 2002)
	\begin{enumerate} 
	\item<2-> \textbf{Very short end of the curve}: central banks nowadays clearly communicate their strategy so that their actions are largely anticipated, leading to low volatilities in this region;
	\item<3-> \textbf{6M to 12-18M}: market participants continuously assess their expectations of future monetary policy, this is the region where subject beliefs have largest impact;
	\item<4-> \textbf{Longer maturities}: lastly, the third segment is much more affected by structural, long-term
	changes in expectations related to inflation and real rates/real returns. Thus, these long-term concerns are more or less independent of short-term monetary policies and the forward rate volatility is relatively low at the long end of the curve.
	\end{enumerate}	
	\end{itemize}
\end{frame}

\begin{frame}{Cap Price Characterization}
	\begin{itemize}
		\item Recall that the $T_{i-1}$-caplet is said to be \emph{at-the-money} when its strike price $K = K_i$ equals the current value $F_i$ of the underlying forward rate. 
		\item The caplet is said to be \emph{in-the-money} when $F_i > K_i$ and \emph{out-of-the-money} when $F_i < K_i$.
		\item What about caps ? they are collections of caplets with a common strike $K$. Each caplet, however, would be ATM for a different strike $K_i$. \item Since it is not possible to define the ATM cap strike $K$ in terms of the single ATM caplet $K_i$, we can however select a single rate that takes into account all the forward rates of the underlying caplets: that is the forward swap rate $K = S_{\alpha,\beta}$.
	\end{itemize}
\end{frame}

\subsection{Log-normal Swap Model}
\begin{frame}{A Model for Swaptions}
  \begin{itemize}
  \item<1-> The counterpart of the Log-normal Forward Libor Model among the market models, is the \textcolor{red}{Log-normal Forward-Swap Model (LSM)}.
  \item<2-> It describes the evolution of the forward swap rates instead of the forward LIBOR rates, these two kind of rates being the bases of the two main markets in the interest rate derivatives world. 
  \item<3-> The settings of this model are similar to the LFM, the \textcolor{red}{relevant exception being the choice of a more convenient numeraire}.
  \end{itemize}
\end{frame}

\begin{frame}{Choice of the Numeraire}
	\begin{itemize}
		\item<1-> From the pricing formula of a payer swaption
		\begin{equation*}
			\textbf{PSw}=\mathbb{E}^{\mathcal{Q}}\left[D(t,T_\alpha)A_{\alpha,\beta}\max(S_{\alpha,\beta}(T_\alpha)-K, 0)\right]
		\end{equation*}
		it comes clearly that the natural choice of numeraire to model the dynamics of the forward swap rate is
		\begin{equation*}
			A_{\alpha,\beta} := \sum^\beta_{i=\alpha+1}\tau_i P(t, T_i)
		\end{equation*}
		which is referred to as the \textcolor{red}{annuity} or the \textcolor{red}{present value of a basis point}, given $\alpha, \beta \in \{0,\ldots, n\}, \alpha < \beta$. 
	  \item<2-> Moreover it has the representation of the value at a time $t$ of a traded asset that is a buy-and-hold portfolio consisting, for each $i$, of $\tau_i$ units of the zero coupon bond maturing at $T_i$, thus it is a plausible numeraire.
	\end{itemize}
\end{frame}

\begin{frame}{Choice of the Numeraire}
  \begin{itemize}
  \item<1-> Denoted by $\mathcal{Q}^{\alpha,\beta}$ the EMM associated with the numeraire $A_{\alpha,\beta}$, the forward swap rate process $S_{\alpha,\beta}$ is a martingale under $\mathcal{Q}^{\alpha,\beta}$, on the interval $[t, T_\alpha]$.
  \begin{equation*}
  	S_{\alpha,\beta}(t) = \cfrac{P(t,T_\alpha)-P(t,T_\beta)}{\sum_{i=\alpha+1}^{\beta}\tau_iP(t,T_i)}
  \end{equation*}
  \item<2-> The probability measure $\mathcal{Q}^{\alpha,\beta}$ is called \textcolor{red}{the (forward) swap measure} related to $\alpha, \beta$.
  \item<2-> We may note that the annuity plays for the swap rate the same role as the zero coupon bond prices did for the forward rates in the LFM. 
  \end{itemize}
\end{frame}

\begin{frame}{Log-normal Forward Swap Model}
  \begin{block}{Definition}
    Consider a fixed subset $\mathcal{T}$ of all the pairs of integer indices ($\alpha, \beta$) of the resettlement dates in the tenor structure $\{T_0, T_1,\ldots, T_n\}$ such that $0 \leq \alpha < \beta \leq n$ and consider for each pair a deterministic function of time $t\rightarrow \sigma_{\alpha,\beta}(t)$. A swap market model (LSM) with volatilities $\sigma_{\alpha,\beta}$ assumes that the forward swap rates have the following dynamics under their associated swap measures:
    \begin{equation}
      dS_{\alpha,\beta}(t) = \sigma_{\alpha,\beta}(t)S_{\alpha,\beta}(t)dW^{\alpha,\beta}(t),\quad t \leq T_\alpha
      \label{eq:swap_rate_dynamics}
    \end{equation}
    for $(\alpha, \beta) \in T$ pairs, where $W^{\alpha,\beta}$ is a scalar standard $\mathcal{Q}^{\alpha,\beta}$-Brownian motion.
  \end{block}
\end{frame}
%%%We can also allows for correlation between the different Brownian motions, however, this will not affect the swaption prices but only the pricing of more complicated products.
%%
%%%Remark 3. In a model with M + 1 resettlement dates it is possible to model
%%%only M swap rates as independent. The two typical choices of possible T
%%%pairs
%%%identify the following substructures:
%%%• the regular SMM, which models the swap rates S0,M, S1,M, . . . , SM−1,M,
%%%i.e.
%%%T
%%%pairs = {(0, M),(1, M), . . . ,(M − 1, M)} ;
%%%• the reverse SMM, which models the swap rates S0,1, S0,2, . . . , S0,M, i.e.
%%%T
%%%pairs = {(0, 1),(0, 2), . . .,(0, M)} .

\begin{frame}{LSM and Black Price Equivalence}
  \begin{block}{Proposition}
    The price of a payer swaption implied by the swap market model coincides with that given by the corresponding Black swaptions formula:
    \begin{equation}
      \textbf{PSw}^{LSM}(T_\alpha,T_\beta,K,v_{\alpha,\beta})=
      A_{\alpha, \beta}(0) \textbf{Sw}^{Black}(K,S_{\alpha,\beta}, v_{\alpha,\beta})
      \label{eq:black_swaptions}
    \end{equation}
    where 
	\begin{equation*}    
		\begin{gathered}	 
   		v_{\alpha,\beta}^2(T) =\frac{1}{T_\alpha}\int_0^T\sigma_{\alpha,\beta}(t)^2dt 	
   		\end{gathered}
    \end{equation*}
  \end{block}
\end{frame}

\begin{frame}{LSM and Black Price Equivalence (Proof)}
	\begin{itemize}
		\item From the risk-neutral pricing formula after a change of numerarie (to the annuity)
		\begin{equation*}
			\begin{aligned}
			\textbf{Sw}&=\mathbb{E}^B\left[D(0,T_\alpha)A_{\alpha,\beta}(T_\alpha)(S_{\alpha,\beta}(T_\alpha)-K)^+\right] = \\
			&=\mathbb{E}^{\alpha,\beta}\left[\frac{A_{\alpha,\beta}(0)}{A_{\alpha,\beta}(T_\alpha)}A_{\alpha,\beta}(T_\alpha)(S_{\alpha,\beta}(T_\alpha)-K)^+\right] = \\		
			&= A_{\alpha,\beta}(0)\mathbb{E}^{\alpha,\beta}\left[(S_{\alpha,\beta}(T_\alpha)-K)^+\right]
		\end{aligned}
		\end{equation*}
		\item Given the swap rate lognormal distribution of \cref{eq:swap_rate_dynamics}, computing the last expectation leads to Black’s formula for swaptions.
		\item Indeed, the above expectation is \textcolor{red}{the classical Black and Scholes price for a call option whose underlying “asset” is $S_{\alpha,\beta}$, struck at $K$, with maturity $T_\alpha$, with 0 constant “risk-free rate” and instantaneous percentage volatility $\sigma_{\alpha,\beta}(t)$.}
	\end{itemize}
\end{frame}

\subsection{Incompatibility between LFM and LSM}
\begin{frame}{Incompatibility between LFM and LSM}
  A crucial question rises: \textcolor{red}{are the two main Market Models, theoretically consistent ?} 
  \pause
  
  Can the assumptions of log-normality of both LIBOR forward rates and forward swap rates coexist? 
  \pause
  In order to give an answer we can proceed as follows:
  \begin{enumerate}
  \item<2-> assume the hypothesis of the LFM, namely that each forward rate $F_i$ is log-normal under its related forward measure $\mathcal{Q}^i$;
  \item<3-> apply the change of measure to obtain their dynamics under the swap measure $\mathcal{Q}^{\alpha,\beta}$, for a choice of $(\alpha,\beta) \in T$ pairs;
  \item<4-> apply the It$\hat{o}$’s formula to obtain the resulting dynamics for the swap rate $S_{\alpha,\beta}$ under $\mathcal{Q}^{\alpha,\beta}$;
  \item<5-> check if this distribution is log-normal, as it is under the hypothesis of the LSM.
  \end{enumerate}
	\uncover<6->{
  \textcolor{red}{Unfortunately, the answer is negative}.} 
\end{frame}

\begin{frame}{Incompatibility between LFM and LSM}
  \begin{itemize}
  \item<1-> However, from a practical point of view, this incompatibility seems to weaken considerably. 
  \item<2-> Indeed, simulating a large number of realizations of $S_{\alpha,\beta}(T_\alpha)$ with the dynamics induced by the LFM one can compute its numerical density and compare it with the log-normal density. 
  \begin{center}
  	\includegraphics[width=0.45\linewidth]{swap_rate_LFM}
  \end{center}
  \end{itemize}
\end{frame}

\begin{frame}{Incompatibility between LFM and LSM}
	\begin{itemize}
	\item<1-> Consequently, it has been argued that, in normal market conditions, the two distributions are hardly distinguishable.
	\item<2-> Once ascertained the mathematical inconsistency of these two models, we must admit that the LSM is particularly convenient when pricing a swaption, because it yields the practice Black’s formula for swaptions. However, for different products, even those involving the swap rate, there is no analytical formula in general. 
  \item<3-> The problem left is choosing either of the two models for the whole market. After that choice, the half market consistent with the model is calibrated almost automatically, thanks to Black’s formulas, but the remaining half is more intricate to calibrate.
	\end{itemize}
\end{frame}

\begin{frame}{Proposed Solution}
  \begin{itemize}
  \item<1-> \textcolor{red}{Since the LIBOR forward rates, rather than swap rates, are more natural and representative coordinates of the yield curve usually considered}, besides being mathematically more manageable, the better choice of modeling may be to \textcolor{red}{assume as framework the Log-normal Forward Libor Model}. 
  \item<2-> Thus, hereafter, we are working under the hypothesis of the LFM. 
  \item<3-> If we choose one of the discount bonds $P(\cdot, T_i)$ as a numeraire, one forward rate will be a martingale, however, the swap rate being a combination of several forward rates, will not. 
  \item<4-> We thus conclude that \textcolor{red}{swaption pricing via Black’s formula is not possible in the LFM}.
    \end{itemize}
\end{frame}

\begin{frame}{Proposed Solution}
	\begin{itemize}
  \item<1-> Brigo and Mercurio derived a complex expression for the swap rate dynamics under the $T$-forward measure induced by the numeraire $P(\cdot, T_i)$.
  \item<2-> But it is not much manageable. There exist, however, very good approximate formulas to the swaption volatility which can be directly used to calibrate to a matrix of quoted swaption volatilities.  
  \item<3-> Also, \textcolor{red}{performing a Monte Carlo simulation to obtain the swaption price is anyway feasible.} 
  
  %\item The LFM, unfortunately, does not feature a known distribution for the joint dynamics of forward rates: to evaluate swaptions, \textcolor{red}{we have to resort to Monte Carlo simulation.}
  \end{itemize}
\end{frame}

\section{Monte Carlo Pricing}
\begin{frame}{Monte Carlo Methods}
  \begin{itemize}
  \item<1-> The Monte Carlo (MC) method is a numerical and probabilistic technique which consists in a computational algorithm relying on repeated independent random sampling to compute approximations of theoretical results.
  \item<2-> In general, MC intends to estimate an expectation value through an arithmetic mean of realizations of i.i.d. random variables and it proceed as follows: 
    \begin{enumerate}
    \item let $X$ be the r.v., with known distribution, on which the expectation we need to estimate depends;
    \item a pseudo-random number generator provides a sequence of realizations $X(k)$ of theoretical independent r.v. $X_1, X_2,\ldots$ distributed as $X$;
    \item then, the desired expectation is approximated by
      \begin{equation*}
	\mathbb{E}[\phi(X)] \approx \frac{1}{m}\sum_{k=1}^m\phi(X^k)
      \end{equation*}
    \end{enumerate}
  \item<3-> Indeed, by the \textcolor{red}{Law of large numbers}, the sample average converges to the expected value, under the hypothesis that $X_i$ is an infinite sequence of i.i.d. random variables with finite expected value.
  \end{itemize}
\end{frame}

\begin{frame}{Monte Carlo Pricing of Swaptions}
  \begin{itemize}
  \item<1-> The most general way to price a swaption, as well as any other option with underlying forward rates, is through Monte Carlo simulation. 
  \item<2-> In order to simulate all the processes involved in the payoff, their joint dynamics is discretized with a numerical scheme for SDEs, e.g. the Euler scheme.
  \item<3-> Recall the price of a payer swaption:
    \begin{equation*}
      \begin{aligned}
        \textbf{PSw} = \mathbb{E}^\mathcal{Q}&\left[D(0, T_\alpha) (S_{\alpha,\beta}(T_\alpha) - K)^+ \sum_{i=\alpha+1}^\beta \tau_i P(T_\alpha, T_i)\right] \\
        &= P(0, T_\alpha)\mathbb{E}^\alpha\left[(S_{\alpha, \beta}(T_\alpha) - K)^+ \sum^\beta_{i=\alpha+1} \tau_i P(T_\alpha, T_i)\right]
      \end{aligned}
    \end{equation*}
    by considering this time $P(\cdot, T_\alpha)$ as numeraire.
  \end{itemize}
\end{frame}

\begin{frame}{Monte Carlo Pricing of Swaptions}
  \begin{itemize}
  \item<1-> Keep in mind that $S_{\alpha,\beta}$ has an expression in terms of the relevant spanning forward rates, and notice that the expectation above depends on the joint distribution of the same $F$’s.
  \item<2-> The dynamics of the $k$-th forward rate, for each $k = \alpha + 1,\ldots, \beta$, under $\mathcal{Q}^\alpha$ is (\cref{eq:forward_rat_dynamics_lfm})
\begin{equation}
  dF_k(t) = \sigma_kF_k\sum_{j=\alpha+1}^k\frac{\rho_{kj}\tau_j\sigma_jF_j}{1+\tau_jF_j}dt+\sigma_kF_k dW^\alpha_k, \quad t<T_\alpha
  \label{eq:dynamics_4.1}
\end{equation}
and, in order to evaluate the swaption payoff we have to generate a number of realization of $F_{\alpha+1}(T_\alpha),\ldots, F_\beta(T_\alpha)$. 
\item<3-> Finally the Monte Carlo price of the swaption is given by the mean of all the payoff evaluations.
  \end{itemize}
\end{frame}

\begin{frame}{Monte Carlo Pricing of Swaptions}
  \begin{itemize}
  \item<1-> Dynamics of \cref{eq:dynamics_4.1} has neither analytical solution nor known distribution, so we need to use the Euler scheme (actually the log version which is easier to handle).
  \item<2-> By the It$\hat{o}$’s formula,
    \begin{equation*}
      d\log F_k(t) = \left(\sigma_k\sum_{j=\alpha+1}^k\frac{\rho_{kj}\tau_j\sigma_jF_j}{1+\tau_jF_j}-\frac{\sigma_k^2}{2}\right)dt+\sigma_k dW^\alpha_k
    \end{equation*}
  \item<3-> Choosing a time grid with step $\Delta t = \cfrac{T_\alpha}{N}$ we get
    \begin{equation*}
      \begin{aligned}
        \log F_k(t_{i+1}) &=\log F_k(t_i) \left(\sigma_k(t_i)\sum_{j=\alpha+1}^k\frac{\rho_{kj}\tau_j\sigma_j(t_i)F_j(t_i)}{1+\tau_jF_j(t_i)}-\frac{\sigma_k(t_i)^2}{2}\right)\Delta t + \\
        &+\sigma_k(t_i) (W^\alpha_k(t_{i+1}) - W^\alpha_k(t_i))
      \end{aligned}
    \end{equation*}
  \item<4-> Which provides us with approximated realizations of the true process $F_k(T_\alpha)$.
  \end{itemize}
\end{frame}

%%Remark 4. We may consider a more refined scheme coming from (4.4) by the
%%following substitution, in the vector version:
%%Σ(ti)(Z
%%α
%%(ti+1) − Z
%%α
%%(ti)) 7−→ ∆ζ(ti),
%%where
%%Σ(t) :=
%%
%%
%%σα+1 0 · · · 0
%%0 σα+2 0 · · · 0
%%.
%%.
%%. 0 .
%%.
%%. 0
%%0 · · · 0 σβ
%%
%%
%%, Zα =
%%
%%
%%Z
%%α
%%α+1
%%Z
%%α
%%α+2
%%.
%%.
%%.
%%Z
%%α
%%β
%%
%%
%%.
%%∆ζ(t) := Z t+∆t
%%t
%%Σ(s)dZα
%%(s) ∼ N (0, Cov(t)),
%%with the covariance n × n matrix, n := β − α, having the elements
%%Covi,j (t) := Z t+∆t
%%t
%%(ΣρΣ
%%′
%%)i,j ds .
%%Indeed, integrating the ln-dynamics (4.3) in the vector version between t
%%and t + ∆t, the resulting stochastic integral in it is just ∆ζ(ti). By means
%%of this substitution, we can simulate more accurate random shocks with
%%gaussian distribution
%%N (0, Cov(t))
%%instead of
%%N (0, ∆tΣρΣ
%%′

\subsection{Confidence Interval}
\begin{frame}{Confidence Interval}
  \begin{itemize}
  \item<1-> Consider a general payoff at time $T$, $\Pi(T)$, depending on a vector of spanning forward LIBOR rates $\bar{F}(t)$. %, for $t \in [0, T]$, where typically $T$ is smaller than or equal to the expiry of the first forward rate.
  \item<2-> We simulate various scenarios of $\Pi(T)$ under the $T$-forward measure. Let $m$ be the number of simulated paths, the Monte Carlo price of the payoff is
    \begin{equation*}
      \mathbb{E}^\mathcal{Q}[D(0,T)\Pi(T)] = P(0,T)\mathbb{E}^T[\Pi(T)]\approx \frac{P(0,T)}{m}\sum_{j=1}^{m}\Pi^j(T)
    \end{equation*}
  \item<3-> Since $\Pi^1(T), \Pi^2(T),\ldots$ is a sequence of realizations of i.i.d. random variables distributed as $\Pi(T)$, the \textcolor{red}{Central Limit Theorem} tell us that for $m\rightarrow\infty$
    \begin{equation*}
      \cfrac{\sum_{j=1}^{m}\Pi^j(T)-\mathbb{E}^T[\Pi(T)]}{\sqrt{m} Std(\Pi(T))}\rightarrow \mathcal{N}(0,1)
    \end{equation*}
  \end{itemize}
\end{frame}

\begin{frame}{Confidence Interval}
  	\begin{columns}
	\column{0.6\linewidth}
	  \begin{itemize}
  	\item<1-> Thus, for large $m$, the following approximation holds
    \begin{equation*}
      \frac{\sum_{j=1}^{m}\Pi^j}{m}-\mathbb{E}^T[\Pi]\approx \frac{Std(\Pi)}{\sqrt{m}}\mathcal{N}(0,1)
    \end{equation*}
	\end{itemize}
	\column{0.4\linewidth}
	\includegraphics[width=0.9\linewidth]{epsilon}
	\end{columns}
	\begin{itemize}
  	\item<2-> The probability that the MC estimate is closer than $\epsilon$ to the true price is
    \begin{equation*}
      P\left(\bigg|\frac{\sum_{j=1}^m\Pi^j}{m}-\mathbb{E}^T[\Pi]\bigg|<\epsilon\right) = P\left(|\mathcal{N}(0,1)|<\epsilon\frac{\sqrt{m}}{Std(\Pi)}\right) =
      2\Phi\left(\epsilon\frac{\sqrt{m}}{Std(\Pi)}\right)-1
    \end{equation*}
    where $\Phi$ denotes the c.d.f. of the standard Gaussian distribution.
    \begin{equation*}
    	\left(P(|x|<\epsilon) = \Phi(\epsilon) - \Phi(-\epsilon) = \Phi(\epsilon) - (1 - \Phi(\epsilon)) = 2\Phi(\epsilon) - 1 \right)
    \end{equation*}
  \end{itemize}
\end{frame}

\begin{frame}{Confidence Interval}
  \begin{columns}
    \column{0.6\linewidth}
    \begin{itemize}
    \item Once we have chosen the desired value for such a probability, we can find the corresponding value for $\epsilon$. For a typical choice of accuracy of 98\%: $\epsilon \approx 2.33 \cfrac{Std(\Pi)}{\sqrt{m}}$
    \item Notice that as $m$ increases, the window shrinks as $1/\sqrt{m}$.
    \end{itemize}
    \column{0.4\linewidth}
    \includegraphics[width=0.9\linewidth]{confidence_interval}
  \end{columns}
  \begin{tikzpicture}[remember picture,overlay]
    \node[xshift=5cm,yshift=-3.7cm] (image) at (current page.center) {\includegraphics[width=20px]{python_logo}};
    \node[align = center, yshift=1.45cm, below=of image] {\tiny{\href{shorturl.at/NPQT1}{shorturl.at/NPQT1}}};
  \end{tikzpicture}
\end{frame}

\subsection{Variance Reduction}
\begin{frame}{Monte Carlo Variance Reduction}
  To reduce the confidence interval without running too many simulations, i.e. reduce the sample variance, without increasing $m$, the \textcolor{red}{control variate technique} can be used.
  \pause
  \begin{enumerate}
  \item<2-> Consider another payoff $\Pi_{an}$ which we can be evaluated analytically, whose expectation is denoted by $\mathbb{E}[\Pi_{an}] = \pi_{an}$, and simulate it together with $\Pi$ under the same scenarios.% for $\bar{F}$.
  \item<3-> Define an unbiased estimator for $\mathbb{E}[\Pi]$ as the sample mean of the random variable 
    \begin{equation*}
      \Pi_c(\gamma) = \Pi + \gamma(\Pi_{an} - \pi_{an})
    \end{equation*}
    Hence $\Pi_c(\gamma)$ has expectation $\mathbb{E}[\Pi]$ and variance
    \begin{equation*}
      Var(\Pi_c(\gamma)) = Var(\Pi) + \gamma^2 Var(\Pi_{an}) + 2\gamma Cov(\Pi, \Pi_{an})
    \end{equation*}
  \end{enumerate}
\end{frame}

\begin{frame}{Monte Carlo Variance Reduction}
	\begin{enumerate}\addtocounter{enumi}{2}
	\item This can be minimized by choosing the appropriate $\gamma$ $\left(\text{from }\frac{\partial Var(\Pi_c)}{\partial\gamma}=0\right)$
	\begin{equation*}
	\gamma^* = -\frac{Cov(\Pi, \Pi_{an})}{Var(\Pi_{an})} = -\frac{Corr(\Pi, \Pi_{an})Std(\Pi)}{Std(\Pi_{an})}, \quad \left(Corr_{XY}=\frac{Cov_{XY}}{Std_X Std_Y}\right)
	\end{equation*}
  	and the minimum variance of $\Pi_c$ is computed as
    \begin{equation*}
     Var(\Pi_c(\gamma^*)) = Var(\Pi)(1 - Corr(\Pi, \Pi_{an})^2)
    \end{equation*}
    that is \textcolor{red}{smaller than the variance of $\Pi$}. Moreover, the \textcolor{red}{larger the correlation between $\Pi$ and $\Pi_{an}$ the larger the difference between the two variances}.
  \end{enumerate}
\end{frame}

\begin{frame}{Monte Carlo Variance Reduction}
	\begin{enumerate}\addtocounter{enumi}{3}
  \item<1-> Moving to the standard deviation
	\begin{equation*}
		Std(\Pi_c(\gamma^*)) = Std(\Pi) \sqrt{(1 - Corr(\Pi, \Pi_{an})^2)}
	\end{equation*}
	the variance reduction will increase with the correlation between $\Pi$ and $\Pi_{an}$. 
	\item<2-> Now if we consider the confidence interval for $\Pi_c$ 
	\begin{equation*}
		98\% C.L. =\left[\Pi_c(\gamma,m) - 2.33\cdot\frac{Std(\Pi_c)}{\sqrt{m}};\Pi_c(\gamma,m) + 2.33\cdot\frac{Std(\Pi_c)}{\sqrt{m}}\right] 
	\end{equation*}
	we get a narrower width by a factor of
	\begin{equation*}
		\sqrt{1 - Corr(\Pi, \Pi_{an}; m)^2}
	\end{equation*}
	\end{enumerate}
\end{frame}

\begin{frame}{Monte Carlo Variance Reduction}
  \begin{itemize}
  \item<1-> This technique is quite general and the \textcolor{red}{choice of $\Pi_{an}$ is theoretically free}.
  \item<2-> In the case of the pricing of swaptions in the LFM, we select as $\Pi_{an}$ one of the simplest payoff with underlying rates $F_{\alpha+1},\ldots,F_\beta$, as may be a portfolio of FRA contracts at time $T_\alpha$ on each single time interval $(T_{i-1}, T_i]$.
  \item<3-> Consider the payoff of such portfolio where the $K_i = F_i(0)$ and rewrite it by a change of measure as follows:
    \begin{equation*}
      \begin{aligned}
        \textbf{FRAs} = &\mathbb{E}^\mathcal{Q}\left[D(0,T_\alpha)\sum_{i=\alpha+1}^\beta P(T_\alpha,T_i)\tau_i(F_i(T_\alpha) - F_i(0))\right] = \\
        &=\mathbb{E}^j\left[\frac{P(0,T_j)}{P(T_\alpha,T_j)}\sum_{i=\alpha+1}^\beta P(T_\alpha,T_i)\tau_i(F_i(T_\alpha) - F_i(0))\right] = \\
        & = P(0,T_j)\mathbb{E}^j\left[\frac{\sum_{i=\alpha+1}^\beta P(T_\alpha,T_i)\tau_i(F_i(T_\alpha) - F_i(0))}{P(T_\alpha,T_j)}\right]
      \end{aligned}
    \end{equation*}
  \end{itemize}
\end{frame}

\begin{frame}{Monte Carlo Variance Reduction}
  \begin{itemize}
  \item<1-> Thus we can set
    \begin{equation*}
      \Pi_{an}(T_\alpha) = \frac{\sum_{i=\alpha+1}^\beta P(T_\alpha,T_i)\tau_i(F_i(T_\alpha) - F_i(0))}{P(T_\alpha,T_j)}
    \end{equation*}
    whose price at time $T_\alpha = 0$ is $\pi_{an} = 0$.
  \item<2-> Indeed, the payoff $\Pi_{an}(\cdot)$ is a sum of traded assets divided by $P(\cdot, T_j)$, hence it is a martingale under the $T^j$-forward measure $\mathcal{Q}^j$, which implies that
    
    \begin{equation*}
      \mathbb{E}^j[\Pi_{an}(T_\alpha)] = \mathbb{E}^j[\Pi_{an}(0)] = 0
    \end{equation*}
  \end{itemize}
\end{frame}

\section{Correlated Brownian Motions}
\subsection{Decorrelation}
\begin{frame}{Correlated Brownian Motions}
  \begin{itemize}
  \item<1-> Correlation is a linear measure of dependency between random variables. Given two random variables $X$ and $Y$, it is given by
  	\begin{equation*}
  		\rho_{X,Y} = \frac{\mathbb{E}((X-\mathbb{E}(X))(Y-\mathbb{E}(Y))}{\sigma_X \sigma_Y}
  	\end{equation*}
  \item<2-> In the LFM, we can assume that the Brownian motions driving the dynamics of forward rate are correlated
    \begin{equation*}
      <dZ_t^{T^i}, dZ_t^{T^i}> = \rho dt
    \end{equation*}
  \item<3-> This model feature is included because the value of a swaption at maturity is influenced by the joint distribution of forward rates and thus by the correlation amongst them. 
  \item<4-> For example, since the underlying in a swaption is a swap rate which in turn is a weighted average of forward rates, we expect the price of a swaption to increase if the forward rates become more correlated. 
  \end{itemize}
\end{frame}

\begin{frame}{Correlated Brownian Motions}
	\begin{itemize}
		\item In models for short rate it is assumed full correlation, i.e. $\rho_{ij}=1$, which is a tight constraint on the dynamics of the forward rates.
		\item When trying to improve these models, one of the objectives is to lower the correlation of the forward rates implied by the model. Some authors refer to this objective as to achieving \textcolor{red}{decorrelation}. 
		\item In the LFM, we can allow it by fine-tuning the corresponding parameters into the dynamics \begin{equation*}
			dF_k(t) = \sigma_kF_k\sum_{j=\alpha+1}^k\frac{\boxed{\rho_{kj}}\tau_j\sigma_jF_j}{1+\tau_jF_j}dt+\sigma_kF_k dZ^\alpha_k
		\end{equation*}
	\end{itemize}
\end{frame}

\begin{frame}{Instantaneous and Terminal Correlation}
	%\begin{itemize}
	%\item For calibrating a LIBOR market model, instantaneous
	%  correlation is modeled. However, for pricing correlation-sensitive products, terminal correlation is used.
	%\item Define an $n$-dimensional LFM with $m$ factors:
	%\begin{equation*}
	%	\frac{df_i}{f_i} = \mu_i dt + \sigma_i \sum_{k=1}^m b_{ik}dZ_k
	%\end{equation*}
	%with $b_k=\frac{\sigma_{ik}}{\sqrt{\sum_{k=1}^m\sigma_{ik}^2}}$
	
	\begin{block}{Definition}
		The \textcolor{red}{instantaneous correlation} is a quantity summarizing the degree of “dependence” between \textcolor{red}{changes of different forward rates}.
		\begin{equation*}
			\rho_{ij} = \frac{dF_i(t) dF_j(t)}{Std(dF_i(t)) Std(dF_j(t))}
		\end{equation*}
		%where $Std$ denotes the standard deviation conditional on the information available at time $t$ at which the change occurs. 
		%The instantaneous correlation of the LIBOR rates $L(t, T_{i-1}, T_i)$ and $L(t, T_{j-1}, T_j)$ is given by the correlation of the increments of the Brownian motions:
		%\begin{equation*}
		%\rho_{i,j}(t) = \sum_{k=1}^m b_{i,k}b_{j,k}, \quad i,j=1,\ldots,n
		%\end{equation*}
		%From this formula it is clear that indeed the instantaneous correlation ρ is related to changes dF in for- ward rates. Instead, 
		The \textcolor{red}{terminal correlation} is a quantity summarizing the degree of “dependence” between \textcolor{red}{two different forward rates at a given \emph{terminal} time-instant}. Typically, the $T_1$ terminal correlation between $F_i$ and $F_j$ is the correlation between $F_i(T_1)$ and $F_j(T_1)$.
	\end{block}
	It is important to understand how instantaneous correlation in the forward-rate dynamics translates into a terminal correlation of simple rates.
	%\begin{block}{Definition}
	%The terminal correlation of the LIBOR rates$L(t, T_{i-1}, T_i)$ and $L(t, T_{j-1}, T_j)$ is given by
	%\begin{equation*}
	%\tilde{\rho}_{i,j}(t) = %\frac{\int_o^t\sigma_i(u)\sigma_j(u)\rho_{i,j}(u)du}{\sqrt{\int_0^t\sigma_i(u)^2du\int_o^t\sigma_j(u)^2du}}
	%\end{equation*}
	%\end{block}
	%\end{itemize}
\end{frame}

\begin{frame}{Instantaneous Correlation}
  \begin{itemize}    
  \item<1-> Insantaneous correlation can be estimated from historical market data.
  \begin{enumerate}
	  \item first derive yield curves for some period of time in the past;
	  \item then, forward curves may be calculated off the yield curves;
	  \item finally the dependence between forward rate increments may be estimated. 
  \end{enumerate}
  \item<2-> Many parametrizations functions have been introduced to express a given correlation matrix of forward rates in a functional form.
  \item<3-> This has several advantages: it is computationally convenient to work with an analytical formula. Noise (e.g. non-synchronous data or illiquidity) is removed by focusing on general properties of correlation. Furthermore, the correlation matrix rank can be controlled through the functional form.
  \item<4-> Anyway it would be nice to imply these correlations out of liquidly traded swaption prices. 
  \end{itemize}
\end{frame}

%\begin{frame}{Correlation Parametrization}
%  \begin{itemize}
%  \item One property that is always implicitly present is time-homogeneity: correlation of forward rates does not depend on calendar time $t$, but only on the rates’ time to maturity $T_i-t$.
%  %\item An important aspect of these parameterizations is the number of parameters used to fit the market data. Most parameterizations advocate the use of few parameters that emphasize general properties of market correlation and prevent overfitting.
%  \item General requirements on an $M \times M$ correlation matrix $\rho$ are:
%	\begin{enumerate}
%		\item $\rho$ must be real and symmetric;
%		\item $\rho_{i,i}=1$ for $i = 1,\ldots, M$;
%		\item $\rho$ must be positive semi-definite such that can be decomposed into $\rho = BB^T$.
%	\end{enumerate}
%	\item Usually parameterizations are determined by minimizing the mean square error between historical market correlation and parameterized functional form.
%	\end{itemize}
%\end{frame}

\begin{frame}{Decorrelation}
\begin{itemize}
	\item<1-> Generally, inferring instantaneous correlations from actively traded swaptions is desirable as they reflect current market conditions, thus not suffering from the backward-looking nature of historically estimated correlations. 
	\item<2-> There are however, also problems with implying correlations from the market. One such general problem is that swaption prices depend on forward rate correlation AND volatility. 
	\item<3-> There is no liquidly traded fixed income derivative that solely depends on correlation, as opposed to caplets, which solely depend on volatility.
	\item<4-> Another problem concerns the relationship between instantaneous and terminal correlations.
\end{itemize}
\end{frame}	
	 
\begin{frame}{Decorrelation}
	\begin{itemize}
	\item<1-> For terminal correlations, (Rebonato, 1998) shows that an appropriate quantity summarizing the amount of decorrelation between two stochastic variables from time 0 to time $t$ is
	\begin{equation}		
		\tilde{\rho}_{ij}(t)=\frac{\int_0^t\sigma_i(u)\sigma_j(u)\rho_{ij}(u)du}{\sqrt{\int_0^t\sigma_i(u)^2 du\int_0^t\sigma_j(u)^2 du}}	
		\label{eq:terminal_correlation}
	\end{equation}
	\item<2-> From this equation, we see that the terminal correlation not only depends on the instantaneous correlation $\rho_{ij}$ but also on the instantaneous volatilities. Hence, even for perfectly instantaneously correlated random variables, $\rho_{ij}= 1$, terminal \textcolor{red}{decorrelation} could be achieved by time-dependent instantaneous volatilities.
\end{itemize}
\end{frame}	
%  \begin{itemize}
%  \item Is terminal correlation completely determined by the instantaneous correlations $\rho_{ij}$ between $W_i$ and $W_j$ ?
%  \item The answer is no, since terminal correlation also depends on the forward rate volatilities (caplet volatilities). 
%  \item In particular it is important the choice of the function $\sigma(t)$ used to recover "average volatilities" through integration in $[0,T_i]$.
%  \item If \textcolor{red}{instantaneous volatilities} are not constant, they have a significant impact on terminal correlation and can produce terminal \emph{decorrelation}, even in the case of perfect instantaneous correlation.
%  %\item Prices of correlation-sensitive products depend on terminal correlation, and thus instantaneous correlation and instantaneous volatility. 
%  %\item It is important to note that there is no instrument that is sensitive solely to instantaneous correlation. Therefore, estimating correlation from a product that is sensitive to multiple factors is not straight-forward and can lead to ambiguous results.
%  \end{itemize}
%\end{frame}

\begin{frame}{An Example}
\begin{itemize}
	\item<1-> Considering Rebonato's analytical formula for terminal correlation \cref{eq:terminal_correlation} it can be shown that in the case of piecewise-constant volatilities, terminal correlation is just the average correlation over the period. 
  	\item<2-> Since the instantaneous volatilities are constant, they can be factored out from the integrals
	  \begin{equation*}	    \tilde{\rho}_{ij}(t)=\frac{\cancel{\sigma_i}\cancel{\sigma_j}\int_0^t\rho_{ij}(u)du}{\sqrt{\cancel{\sigma_i^2}\cancel{\sigma_j^2} t^2}}= \frac{\int_0^t\rho_{ij}(u)du}{t}		
  	\end{equation*}
  	which indeed leads to lower terminal correlation.
  	\item<3-> Swaption payoffs depend on the terminal correlation between several different forward rates which leads (Brigo and Mercurio, 2006) to the conclusion that swaption volatilities are more directly linked with terminal correlations rather than with instantaneous ones.
  \end{itemize}
\end{frame}

\end{document}
