\begin{question}
Assume that company A has agreed to pay a 6-month Libor and receive a fixed interest rate of 8\% per year (with interest payable every six months) from the face value of \$100 million. Swap is 1.25 years to expire. The interest rates for 3, 9 and 15 months are: 10\%, 10.5\% and 11\% respectively. Assume that interest rates are continously compounded. The 6-month Libor is currently 10.2\%. 

Calculate the value of this swap for company A.
\end{question}

\cprotEnv\begin{solution}
\begin{ipython}

\end{ipython}
\begin{ioutput}

\end{ioutput}
\end{solution}

\begin{question}
Suppouse that the LIBOR Forward rates and the discount curve are those defined in
\href{https://github.com/matteosan1/finance_course/raw/develop/libro/input_files/libor_curve.xlsx}{libor\_curve.xlsx} and \href{https://github.com/matteosan1/finance_course/raw/develop/libro/input_files/discount_curve.xlsx}{discount\_curve.xlsx} respectively.
Determine the value of an option to pay a fixed rate of 4\% and receives LIBOR on a 5 year swap starting in 1 year. Assume the notional is 100 EUR, the exercise date is on October, 30th 2020 and the swap rate volatility is 15\%.
\end{question}

\cprotEnv\begin{solution}
\begin{ipython}
from finmarkets import InterestRateSwap
from datetime import date
from dateutil.relativedelta import relativedelta
from curve_data import discount_curve, libor_curve
from scipy.stats import norm
import math

pricing_date = date.today()
start_date = date.today() + relativedelta(years=1)
exercise_date = date(2020, 10, 30)

irs = InterestRateSwap(start_date, 100, 0.04, 12, 5)
sigma = 0.15
A = irs.annuity(discount_curve, pricing_date)
S = irs.swap_rate(discount_curve, libor_curve, pricing_date)
T = (exercise_date - pricing_date).days / 365
d1 = (math.log(S/irs.fixed_rate) + 0.5 * sigma**2 * T) / (sigma * T**0.5)
d2 = (math.log(S/irs.fixed_rate) - 0.5 * sigma**2 * T) / (sigma * T**0.5)
npv = irs.notional * A * (S * norm.cdf(d1) - irs.fixed_rate * norm.cdf(d2))

print("Swaption NPV: {:.3f} EUR".format(npv))
\end{ipython}
\begin{ioutput}
Swaption NPV: 13.587 EUR
\end{ioutput}
\end{solution}

\begin{question}
A \emph{currency swap}, sometimes referred to as a cross-currency swap, involves the exchange of interest—and sometimes of principal—in one currency for the same in another currency. Interest payments are exchanged at fixed dates through the life of the contract. 

Assume that yield curves in Japan and in the US are flat. The interest rate in Japan is equal to 4\% per annum, and in the US to 9\% per annum (with continuous compounding). A financial institution takes position in a swap contract, under which it receives 5\% on an annual basis of the amount denominated in yen and pays 8\% per annum of the amount denominated in dollars. These amounts are respectively 10 million USD and 1200 million yen. The contract is valid for 3 years and the current exchange rate is 110 USDJPY. What is the value of this currency swap?

\textbf{Hint:} write a \texttt{CurrencySwap} class in order to valuate the swap.
\end{question}

\cprotEnv\begin{solution}
\begin{ipython}
import numpy as np

class CurrencySwap:
    def __init__(self, amount_for, amount_dom, r_for, r_dom,
        fixed_for, fixed_dom, exchg_rate, maturity):
        self.amount_for = amount_for
        self.amount_dom = amount_dom
        self.r_for = r_for
        self.r_dom = r_dom
        self.fixed_for = fixed_for
        self.fixed_dom = fixed_dom
        self.exchg_rate = exchg_rate # for/dom
        self.maturity = maturity

    def foreign_npv(self):
        b_f = 0
        for t in range(1, maturity+1):
            b_f += np.exp(-self.r_for*t)*self.fixed_for*self.amount_for
        b_f += np.exp(-self.r_for*t)*self.amount_for
        return b_f

    def domestic_npv(self):
        b_d = 0
        for t in range(1, maturity+1):
            b_d += np.exp(-self.r_dom*t)*self.fixed_dom*self.amount_dom
        b_d += np.exp(-self.r_dom*t)*self.amount_dom
        return b_d

    def value_dom(self):
        return self.foreign_npv()/self.exchg_rate - self.domestic_npv()

    def value_for(self):
        return self.domestic_npv()*self.exchg_rate - self.foreign_npv() 
\end{ipython}
\noindent
\begin{ipython}
rf = 0.04
rd = 0.09
kf = 0.05
kd = 0.08
Nf = 1200e6
Nd = 10e6
S = 110

cs = CurrencySwap(Nf, Nd, rf, rd, kf, kd, S)
print ("Domestic Value: {:.0f} USD".format(cs.value_dom()))
print ("Foreign Value: {:.0f} yen".format(cs.value_for()))
\end{ipython}
\begin{ioutput}
Domestic Value: 1542996 USD
Foreign Value: -169729535 yen
\end{ioutput}

The swap value for the financial institution is about 1.54 million USD. If the institution paid in yen and received cash flows in dollars, the swap value would be around -1697 million yen.
\end{solution}