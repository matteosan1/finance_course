\chapter{Date and Time}
\label{sec:datetime}

In this Chapter we take a little break and concentrate on a topic that it is not usually covered 
in a \texttt{python} review for beginners. However given its importance for financial computation 
the next paragraphs will be devoted to a close look up on the $\tt{datetime}$ module~\cite{bib:datetime}, whose usage 
will help in manipulating dates.

\section{Dates}\label{dates}

As said dates are not usually included in a standard \texttt{python} tutorial, however since they 
are pretty essential for finance we are going to cover this topic in some detail. 
In \texttt{python} the date utilities mainly lives in the \texttt{datetime} module. Briefly we are 
also going to show \texttt{relativedelta} from the \texttt{dateutil} module, which allows to 
add/subtract days/months/years to dates, in other words to make operations on them.

In this first example today's date is defined and with $\tt{relativedelta}$ two more dates are created 
adding two months and subtracting three days to the first one.

\begin{codebox}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{from} \PY{n+nn}{datetime} \PY{k}{import} \PY{n}{date}\PY{p}{,} \PY{n}{datetime}
\PY{k+kn}{from} \PY{n+nn}{dateutil}\PY{n+nn}{.}\PY{n+nn}{relativedelta} \PY{k}{import} \PY{n}{relativedelta}

\PY{n}{date1} \PY{o}{=} \PY{n}{date}\PY{o}{.}\PY{n}{today}\PY{p}{(}\PY{p}{)}
\PY{n+nb}{print} \PY{p}{(}\PY{n}{date1}\PY{p}{)}
\PY{n}{date2} \PY{o}{=} \PY{n}{date}\PY{o}{.}\PY{n}{today}\PY{p}{(}\PY{p}{)} \PY{o}{+} \PY{n}{relativedelta}\PY{p}{(}\PY{n}{months}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n+nb}{print} \PY{p}{(}\PY{n}{date2}\PY{p}{)}
\PY{n}{date3} \PY{o}{=} \PY{n}{date}\PY{o}{.}\PY{n}{today}\PY{p}{(}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{n}{relativedelta}\PY{p}{(}\PY{n}{days}\PY{o}{=}\PY{l+m+mi}{3}\PY{p}{)}
\PY{n+nb}{print} \PY{p}{(}\PY{n}{date3}\PY{p}{)}

2020-08-03
2020-10-03
2020-07-31
\end{Verbatim}
\end{codebox}

There is another way of computing a new date: a one day delta is stored in a variable 
and today's date is moved by three days multiplying the defined delta by three.

\begin{codebox}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{one\PYZus{}day} \PY{o}{=} \PY{n}{relativedelta}\PY{p}{(}\PY{n}{days}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{date}\PY{o}{.}\PY{n}{today}\PY{p}{(}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{l+m+mi}{3} \PY{o}{*} \PY{n}{one\PYZus{}day}

datetime.date(2020, 7, 31)
\end{Verbatim}
\end{codebox}

Next, given two dates their difference is computed and expressed in number of days.

\begin{codebox}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{date1} \PY{o}{=} \PY{n}{date}\PY{p}{(}\PY{l+m+mi}{2019}\PY{p}{,} \PY{l+m+mi}{7}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{date2} \PY{o}{=} \PY{n}{date}\PY{p}{(}\PY{l+m+mi}{2019}\PY{p}{,} \PY{l+m+mi}{8}\PY{p}{,} \PY{l+m+mi}{16}\PY{p}{)}
\PY{p}{(}\PY{n}{date2} \PY{o}{\PYZhy{}} \PY{n}{date1}\PY{p}{)}\PY{o}{.}\PY{n}{days}

45
\end{Verbatim}
\end{codebox}

Dates can be converted to and from strings and a large variety of formats can be specified in this conversions. 
The format is determined by a string in which each character starting with \% represent an element 
of the date, e.g. \%Y year, \%d day, \%s seconds\ldots

Below dates to string conversion:

\begin{codebox}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{date1} \PY{o}{=} \PY{n}{date}\PY{p}{(}\PY{l+m+mi}{2019}\PY{p}{,} \PY{l+m+mi}{7}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{date1}\PY{o}{.}\PY{n}{strftime}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZpc{}}\PY{l+s+s2}{Y\PYZhy{}}\PY{l+s+s2}{\PYZpc{}}\PY{l+s+s2}{b\PYZhy{}}\PY{l+s+si}{\PYZpc{}d}\PY{l+s+s2}{ (}\PY{l+s+si}{\PYZpc{}a}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)} \PY{c+c1}{\PYZsh{} dates can formatted in many ways}
                                \PY{c+c1}{\PYZsh{} check the docs for more details}

'2019-Jul-02 (Tue)'
\end{Verbatim}
\end{codebox}

And here, a string is converted to \texttt{datetime} object:

\begin{codebox}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} a string can be converted to dates too}
\PY{n}{datetime}\PY{o}{.}\PY{n}{strptime}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{25 Aug 2019}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+si}{\PYZpc{}d}\PY{l+s+s2}{ }\PY{l+s+s2}{\PYZpc{}}\PY{l+s+s2}{b }\PY{l+s+s2}{\PYZpc{}}\PY{l+s+s2}{Y}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{o}{.}\PY{n}{date}\PY{p}{(}\PY{p}{)}

datetime.date(2019, 8, 25)
\end{Verbatim}
\end{codebox}

Finally a last example showing how to get the week-day from a date:

\begin{codebox}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{date1}\PY{o}{.}\PY{n}{weekday}\PY{p}{(}\PY{p}{)} \PY{c+c1}{\PYZsh{} 0 = Monday, ..., 6 = Sunday}

1
\end{Verbatim}
\end{codebox}

\section{Exercises}
\input{datetime_ex_text}

\begin{thebibliography}{9}
\bibitem{bib:datetime} \href{https://realpython.com/python-datetime/}{\emph{Using Python datetime to Work With Dates and Times}}, Real Python [Online]
\end{thebibliography}