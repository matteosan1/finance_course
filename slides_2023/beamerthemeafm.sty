\usepackage{multicol}
\usepackage{amsmath}
\usepackage[bb=dsserif]{mathalpha}
\usepackage{bm}
\usepackage{cancel}
\usepackage{xcolor}
\usepackage{pifont}
\newcommand{\goodcheck}{\color{green}\ding{52}}
\newcommand{\badcheck}{\color{red}\ding{56}}

\RequirePackage{etoolbox}
\RequirePackage{tikz}
\usetikzlibrary{calc,positioning}

\RequirePackage{geometry}
\geometry{paperwidth=16cm,paperheight=9cm}

%\RequirePackage{caladea,carlito}
%\renewcommand{\familydefault}{\sfdefault}

% No navigation symbols
\setbeamertemplate{navigation symbols}{}

\RequirePackage{graphicx}

\RequirePackage{xcolor}

% Main colour
\definecolor{maincolor}{RGB/cmyk}{130,36,51/10,100,61,50}

% "Warm grey"
\definecolor{sintefgrey}{RGB/cmyk}{235,235,230/0,0,0,.1}
\colorlet{sintefgray}{sintefgrey}

% Greens
\definecolorset{RGB/cmyk}{sintef}{}{lightgreen, 205,250,225/.23, 0,.20, 0;%
	green,       20,185,120/.73, 0,.67, 0;%
	darkgreen,    0, 70, 40/.93,.43,.92,.52}

% Additional colours
\definecolorset{RGB/cmyk}{sintef}{}{yellow, 200,155,20/20, 36,98, 8;%
	red,    190, 60,55/19, 86,77, 8;%
	lilla,  120,  0,80/48,100,27,31}

% Deprecated colours for backward compatibility
\definecolorset{HTML}{sintef}{}{cyan,      22A7E5;%
	magenta,   EC008C;%
	lightgrey, D8D0C7}
\colorlet{sinteflightgray}{sinteflightgrey}

\hypersetup{colorlinks,linkcolor=,urlcolor=maincolor}

\usepackage[capitalize]{cleveref}
\let\chyperref\cref
\renewcommand{\cref}[1]{\hyperlink{#1}{\chyperref{#1}}}


\newcommand{\atfootlineauthor}{\insertauthor \enspace$\vert$\enspace}
\newcommand{\atfootlinepayoff}{\atfootlineauthor\inserttitle}
\newcommand{\footlinepayoff}[1]{\renewcommand{\atfootlinepayoff}{#1}}
%Define footline content
\setbeamertemplate{footline}{%
	\begin{beamercolorbox}[wd=\textwidth,ht=5mm,dp=3mm,rightskip=1cm,leftskip=1cm]{footline}
		\insertframenumber/\inserttotalframenumber
		\ifstrempty{\atfootlinepayoff}{}{%
			\usebeamerfont{footline}\hfill\atfootlinepayoff
		}
	\end{beamercolorbox}
}

% Set footline AND coordinate blocks with it
\newcommand{\footlinecolor}[1]{% if #1 is empty, makes footline transparent
	\ifstrempty{#1}{%
		\footlinepayoff{}
		\setbeamercolor{footline}{fg=darkgray, bg=}
		\setbeamercolor{block title}{fg=white,bg=maincolor}
		\setbeamercolor{block body}{fg=white,bg=maincolor}
	}{
		\footlinepayoff{\@footlineauthor\inserttitle}
		\setbeamercolor{footline}{fg=white,bg=#1}
		\setbeamercolor{block title}{fg=white,bg=#1}
		\setbeamercolor{block body}{fg=white,bg=#1}
	}%
}
\footlinecolor{} % Default: no footline

\pgfdeclareimage[width=0.07\paperwidth]{logo}{Logo_Unisi_2012_transp}%assets/logo_RGB}
\pgfdeclareimage[width=0.07\paperwidth]{whitelogo}{Logo_Unisi_2012_inver}%assets/logo_RGB_negative}
\newcommand{\atlogo}{logo}

\newcommand{\themecolor}[1]{
\ifstrequal{#1}{main}{%
\setbeamercolor{footline}{fg=white}
\setbeamercolor{normal text}{fg=white,bg=maincolor}
\setbeamercolor{structure}{fg=white}
\renewcommand{\atlogo}{whitelogo}
\setbeamercolor{block title}{fg=maincolor,bg=sintefgrey}
\setbeamercolor{block body}{fg=darkgray,bg=sintefgrey}
}{%
\setbeamercolor{footline}{fg=darkgray}
\setbeamercolor{normal text}{fg=darkgray,bg=white}
\setbeamercolor{structure}{fg=maincolor}
\renewcommand{\atlogo}{logo}
\setbeamercolor{block title}{fg=white,bg=maincolor}
\setbeamercolor{block body}{fg=darkgray,bg=sintefgrey}
}
}
\themecolor{white} % Default: white theme

\setbeamercolor{title}{fg=maincolor,bg=white}
\setbeamercolor{alerted text}{fg=sintefred}
\setbeamercolor{author}{fg=black}
\setbeamercolor{date}{fg=black}

\setbeamerfont{author}{size=\scriptsize}
\setbeamerfont{date}{size=\tiny}
\setbeamerfont{title}{series=\bfseries, size=\huge}
\setbeamerfont{subtitle}{series=\mdseries,size=\footnotesize}
\setbeamerfont{frametitle}{series=\bfseries, size=\LARGE}
\setbeamerfont{framesubtitle}{series=\mdseries}
\setbeamerfont{footline}{size=\scriptsize}
\setbeamerfont{block title}{series=\centering\bfseries}

% Code to get prettier boxes
\setbeamertemplate{blocks}[rounded]

% Bullets in several levels
\setbeamertemplate{itemize item}{\textbullet}
\setbeamertemplate{itemize subitem}{\textemdash}
\setbeamertemplate{itemize subsubitem}{\ensuremath{\circ}}

%\newenvironment{colorblock}[3][white]{%
%	\begingroup
%	\setbeamercolor{block title}{fg=#1,bg=#2}
%	\setbeamercolor{block body} {fg=#1,bg=#2}
%	\begin{block}{#3}
%	}{%
%	\end{block}
%	\endgroup
%}

% Put the logo in each slide's top left area
\setbeamertemplate{headline}{\hspace{0.01\textwidth}\pgfuseimage{\atlogo}}

% Define frame title and subtitle layout
\setbeamertemplate{frametitle}{%
\vspace*{-3.65ex}
\begin{beamercolorbox}[leftskip=2cm]{frametitle}%
\usebeamerfont{frametitle}\insertframetitle\\
\usebeamerfont{framesubtitle}\insertframesubtitle
\end{beamercolorbox}
\vspace{0.25cm}
%\hrule
}

\def\atcourseLabel{}
\newcommand{\course}[1]{\def\atcourseLabel{#1}}

\pgfdeclareimage[width=0.15\linewidth]{mybackground}{mps}
\pgfdeclareimage[width=0.90\linewidth]{abstract}{copertina}

% Define the title page
\setbeamertemplate{title page}{%
\vskip0pt plus 1filll%
% Reposition the box in an inelegant way - but it works!
\hspace{-12mm}
\vspace{20mm}
\begin{beamercolorbox}[wd=0.72\textwidth,sep=10pt,leftskip=8mm]{title}%
{\usebeamerfont{title}\inserttitle}

{\usebeamerfont{subtitle}\insertsubtitle}

\vspace{0.5cm}

{\usebeamerfont{subtitle}\atcourseLabel}

{\usebeamerfont{author}\usebeamercolor[fg]{author}\textbf{\insertauthor}}

\begin{picture}(0,0)
	\put(-2, -20){%
		\pgfuseimage{mybackground}
	}
\end{picture}
\begin{picture}(0,0)
	\put(145, -70){%
		\pgfuseimage{abstract}
	}
\end{picture}
%{\usebeamerfont{date}\usebeamercolor[fg]{date}\insertdate}
\end{beamercolorbox}
}

% Define slide splitting dimensions (e.g. title and chapter slides)
\newcommand{\TikzSplitSlide}[1]{%
\rule{0.56\paperwidth}{0pt}%
\begin{tikzpicture}
\clip (-0.1\paperwidth,-0.5\paperheight) -- 
( 0.5\paperwidth,-0.5\paperheight) -- 
( 0.5\paperwidth, 0.5\paperheight) -- 
( 0.1\paperwidth, 0.5\paperheight) -- cycle; 
\node at (0.2\paperwidth,0) {%
	\includegraphics[height=\paperheight]{#1}%
};
\end{tikzpicture}
}

\makeatletter
\newenvironment{withoutheadline}{
\setbeamertemplate{headline}[default]
\def\beameratentrycode{\vspace*{-\headheight}}
}{}
\makeatother

% Define sectioning and table of contents
\AtBeginSection[]
{
\begingroup
\themecolor{main}
\begin{frame}{Table of Contents}
\begin{multicols}{2}
\tableofcontents[currentsection]
\end{multicols}
\end{frame}
\endgroup
}

% style of section presented in the table of contents
\setbeamertemplate{section in toc}{$\blacktriangleright$~\inserttocsection}

% automate subtitle of each frame
\makeatletter
\pretocmd\beameratcheckframetitle{\framesubtitle{\thesection \, \secname}}
\makeatother

% avoid numbering of frames that are breaked into multiply slides
\setbeamertemplate{frametitle continuation}{}


\usepackage{listings}
\usepackage{cprotect}
\definecolor{maroon}{cmyk}{0, 0.87, 0.68, 0.32}
\definecolor{halfgray}{gray}{0.55}
\definecolor{ipython-frame}{RGB}{207, 207, 207}
\definecolor{ipython-bg}{RGB}{247, 247, 247}
\definecolor{ipython-red}{RGB}{186, 33, 33}
\definecolor{ipython-green}{RGB}{0, 128, 0}
\definecolor{ipython-cyan}{RGB}{64, 128, 128}
\definecolor{ipython-purple}{RGB}{170, 34, 255}

\renewcommand\ttfamily{\fontfamily{pcr}\selectfont}%}

\lstdefinelanguage{iPython}{
  morekeywords={access,and,del,except,exec,in,is,lambda,not,or,raise},
  morekeywords=[2]{for,print,abs,all,any,basestring,bin,bool,bytearray,callable,chr,classmethod,cmp,compile,complex,delattr,dict,dir,divmod,enumerate,eval,execfile,file,filter,float,format,frozenset,getattr,globals,hasattr,hash,help,hex,id,input,int,isinstance,issubclass,iter,len,list,locals,long,map,max,memoryview,min,next,object,oct,open,ord,pow,property,range,reduce,reload,repr,reversed,round,set,setattr,slice,sorted,staticmethod,str,sum,super,tuple,type,unichr,unicode,vars,xrange,zip,apply,buffer,coerce,intern,elif,else,if,continue,break,while,class,def,return,try,except,import,finally,try,except,from,global,pass, True, False},
  sensitive=true,
  morecomment=[l]\#,%
  morestring=[b]',%
  morestring=[b]",%
  moredelim=**[is][\color{black}]{@@}{@@},
  identifierstyle=\color{black}\scriptsize\ttfamily,
  commentstyle=\color{ipython-cyan}\scriptsize\itshape\ttfamily,
  stringstyle=\color{ipython-red}\scriptsize\ttfamily,
  keepspaces=true,
  showspaces=false,
  showstringspaces=false,
  rulecolor=\color{ipython-frame},
  frame=single,
  frameround={t}{t}{t}{t},
  backgroundcolor=\color{ipython-bg},
  basicstyle=\scriptsize\ttfamily,
  keywordstyle=[2]\color{ipython-green}\bfseries\scriptsize\ttfamily, 
  keywordstyle=\color{ipython-purple}\bfseries\scriptsize\ttfamily
}

\lstdefinelanguage{iOutput} {
  sensitive=true,
  identifierstyle=\color{black}\scriptsize\ttfamily,
  stringstyle=\color{ipython-red}\scriptsize\ttfamily,
  keepspaces=true,
  showspaces=false,
  showstringspaces=false,
  rulecolor=\color{ipython-frame},
  basicstyle=\scriptsize\ttfamily,
}

\lstdefinestyle{attstyle}{
	backgroundcolor=\color{cream},
	rulecolor=\color{goldenrod}
}

\lstnewenvironment{attpython}[1][]{
	\lstset{language=iPython,style=attstyle,mathescape=true}%
}{%
}

%\lstset{style=mystyle}
\lstnewenvironment{ipython}[1][]{\lstset{language=iPython,mathescape=true,escapeinside={*@}{@*}}%
}{%
}

\lstnewenvironment{ioutput}[1][]{\lstset{language=iOutput,mathescape=true,escapeinside={*@}{@*}}%
}{%
}
